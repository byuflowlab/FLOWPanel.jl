<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Least-Squares Solver · FLOWPanel.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="FLOWPanel.jl logo"/></a><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Intro</a></li><li><a class="tocitem" href="../../potentialflow/">Potential Flow</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Elements</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../elements/paneldefinition/">Panel Definition</a></li><li><a class="tocitem" href="../../elements/constantsource/">Constant Source</a></li><li><a class="tocitem" href="../../elements/constantdoublet/">Constant Doublet</a></li><li><a class="tocitem" href="../../elements/semiinfdoublet/">Semi-Infinite Doublet</a></li><li><a class="tocitem" href="../../elements/semiinfnonplanardoublet/">Non-Planar Semi-Infinite Doublet</a></li><li><a class="tocitem" href="../../elements/constantvortexsheet/">Constant Vortex Sheet</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Geometry Engine</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Grid Generation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../geometry/gridgeneration/">Methods</a></li><li><a class="tocitem" href="../../geometry/gridgeneration-loft/">Lofting Method</a></li><li><a class="tocitem" href="../../geometry/gridgeneration-pathloft/">Path-Lofting Method</a></li><li><a class="tocitem" href="../../geometry/gridgeneration-rev/">Surface of Revolution Method</a></li><li><a class="tocitem" href="../../geometry/gridgeneration-transf/">Space Transformation Method</a></li><li><a class="tocitem" href="../../geometry/gridgeneration-triang/">Grid Triangulation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Advanced</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../geometry/basics/"><code>GeometricTools.jl</code></a></li><li><a class="tocitem" href="../../geometry/basics-grid/">Cartesian Grid</a></li><li><a class="tocitem" href="../../geometry/basics-transformations/">Space Transformations</a></li><li><a class="tocitem" href="../../geometry/basics-loopedgrid/">Looped Grid</a></li><li><a class="tocitem" href="../../geometry/basics-surfacegrid/">Surface Grid</a></li><li><a class="tocitem" href="../../geometry/panel-gradient/">Panel Gradients</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox" checked/><label class="tocitem" for="menuitem-5"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">Swept Wing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../sweptwing-4p2aoa/">4.2° Angle of Attack</a></li><li><a class="tocitem" href="../sweptwing-aoasweep/">AOA Sweep</a></li><li><a class="tocitem" href="../sweptwing-solver/">Solver Benchmark</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Centerbody</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../centerbody-source/">Source Elements</a></li><li><a class="tocitem" href="../centerbody-slice/">Slice</a></li><li><a class="tocitem" href="../centerbody-vortexring/">Vortex Ring Elements</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox" checked/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Duct</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../duct-aoasweep/">AOA Sweep</a></li><li><a class="tocitem" href="../duct-fluiddomain/">Fluid Domain</a></li><li class="is-active"><a class="tocitem" href>Least-Squares Solver</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-4" type="checkbox"/><label class="tocitem" for="menuitem-5-4"><span class="docs-label">Blended Wing Body</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../blendedwingbody-cad/">CAD Model</a></li><li><a class="tocitem" href="../blendedwingbody-gmsh/">Unstructured Meshing</a></li><li><a class="tocitem" href="../blendedwingbody-TE/">Export Trailing Edge</a></li><li><a class="tocitem" href="../blendedwingbody-aero/">Import Mesh and Solve</a></li><li><a class="tocitem" href="../blendedwingbody-gpucpu/">GPU and CPU Acceleration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-5" type="checkbox"/><label class="tocitem" for="menuitem-5-5"><span class="docs-label">Cessna 210</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../cessna-openvsp/">OpenVSP Model</a></li><li><a class="tocitem" href="../cessna-TE/">Export Trailing Edge</a></li><li><a class="tocitem" href="../cessna-aero/">Import Mesh and Solve</a></li><li><a class="tocitem" href="../cessna-vspgeom/">VSPGeom.jl</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li><a class="is-disabled">Duct</a></li><li class="is-active"><a href>Least-Squares Solver</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Least-Squares Solver</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/byuflowlab/FLOWPanel.jl/blob/master/docs/src/examples/duct-leastsquares.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Least-Squares-Solver"><a class="docs-heading-anchor" href="#Least-Squares-Solver">Least-Squares Solver</a><a id="Least-Squares-Solver-1"></a><a class="docs-heading-anchor-permalink" href="#Least-Squares-Solver" title="Permalink"></a></h1><p>It is well known that a purely doublet (or vortex ring) solver encounters difficulties when the geometry is closed (<em>i.e.</em>, watertight). The flow field around a body is given by the vortex filaments that make the edges of the panel, and the strength of each filament is simply the difference between adjacent panels. Thus, in the absence of an open edge (like in a watertight geometry), the strengths of the vortex-ring elements become irrelevant, and the problem is purely determined by the difference in strength between adjacent panels. This leads to an overdetermined problem where one of the original degrees of freedom (panels strengths) has become redundant.</p><p>Let <span>$n$</span> the number of panels. The problem is well defined for a open geometry formulating the solver as</p><p class="math-container">\[\begin{align*}
    G \Gamma = -b
,\end{align*}\]</p><p>where <span>$b \in \mathbb{R}^{n}$</span> is the normal of the freestream condition at each panel that needs to be canceled (&quot;no-flow-through&quot; boundary condition), <span>$G \in \mathbb{R}^{n\times n}$</span> contains the geometric information of the panels and <span>$\Gamma \in \mathbb{R}^{n}$</span> is the strength of each vortex-ring panel. However, for a watertight geometry, <span>$G$</span> is no longer full rank and the problem becomes ill-conditioned. Due to numerical roundoff, the system of equations can still be inverted but the numerical solution ends up giving panel strengths (vortex-ring circulations) that are in the order of <span>$10^{16}$</span> and large numerical noise.</p><p>In order to circumvent this issue, we can transform the original problem into a least-squares problem as follows. Since one of the panel strengths is redundant in a watertight geometry, we can simply pick an arbitrary panel and prescribe an arbitrary strength. Then, <span>$G$</span> has become a <span>$n\times n-1$</span> matrix, <span>$\Gamma$</span> is a vector of length <span>$n-1$</span>, while <span>$b$</span> is still a vector of length <span>$n$</span>. To formulate the least-squares problem, we substract the velocity <span>$b_p$</span> induced by the &quot;prescribed&quot; panel  to the right-hand side,</p><p class="math-container">\[\begin{align*}
    G \Gamma = -b - b_p
,\end{align*}\]</p><p>and we solve the problem as</p><p class="math-container">\[\begin{align*}
    \Gamma = - \left( G^{t} G \right)^{-1} G^{t} \left( b + b_p \right)
,\end{align*}\]</p><p>where the superscript <span>$t$</span> denotes the transposed matrix.</p><p>Either solver (<em>i.e.</em>, the original vortex-ring solver or the vortex-ring least-squares one) is automatically called whenever the function <code>FLOWPanel.solve(body, Uinfs, Das, Dbs)</code> is called. The solver to be used is identified based on the body type. A body type <code>bodytype = pnl.RigidWakeBody{pnl.VortexRing}</code> corresponds to the original vortex-ring solver, while the least-squares solver is called by declaring <code>bodytype = pnl.RigidWakeBody{pnl.VortexRing, 2}</code>.</p><blockquote><p><strong>NOTE:</strong> The prescribed panel can be manually set by the user through the optional argument <code>elprescribe = [(index, val), ...]</code> of <code>FLOWPanel.solve</code>, which is a list of element to prescribe, where <code>index</code> is the linear index of the element and <code>val</code> is the prescribed element strength. If not set, the function defaults to <code>FLOWPanel.solve(body, Uinfs, Das, Dbs; elprescribe=[(1, 0)])</code></p></blockquote><p>Even though both solvers lead to roughly the same flow field solution, the numerical noise of the ill-condition problem is evident when visualizing the potential field:</p><center>
    <br><b>Vortex-Ring Solver</b><br>
    <img src="../../assets/images/duct-hill0110-viz-phi00.png" alt="Pic here" style="width:70%;"/>
</center>
<br>
<center>
    <br><b>Vortex-Ring Least-Squares Solver</b><br>
    <img src="../../assets/images/duct-hill0111-viz-phi00.png" alt="Pic here" style="width:70%;"/>
</center></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../duct-fluiddomain/">« Fluid Domain</a><a class="docs-footer-nextpage" href="../blendedwingbody-cad/">CAD Model »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 24 January 2025 18:40">Friday 24 January 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
