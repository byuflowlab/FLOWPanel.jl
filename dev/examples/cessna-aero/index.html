<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Import Mesh and Solve · FLOWPanel.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="FLOWPanel.jl logo"/></a><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Intro</a></li><li><a class="tocitem" href="../../potentialflow/">Potential Flow</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Elements</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../elements/paneldefinition/">Panel Definition</a></li><li><a class="tocitem" href="../../elements/constantsource/">Constant Source</a></li><li><a class="tocitem" href="../../elements/constantdoublet/">Constant Doublet</a></li><li><a class="tocitem" href="../../elements/semiinfdoublet/">Semi-Infinite Doublet</a></li><li><a class="tocitem" href="../../elements/semiinfnonplanardoublet/">Non-Planar Semi-Infinite Doublet</a></li><li><a class="tocitem" href="../../elements/constantvortexsheet/">Constant Vortex Sheet</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Geometry Engine</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Grid Generation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../geometry/gridgeneration/">Methods</a></li><li><a class="tocitem" href="../../geometry/gridgeneration-loft/">Lofting Method</a></li><li><a class="tocitem" href="../../geometry/gridgeneration-pathloft/">Path-Lofting Method</a></li><li><a class="tocitem" href="../../geometry/gridgeneration-rev/">Surface of Revolution Method</a></li><li><a class="tocitem" href="../../geometry/gridgeneration-transf/">Space Transformation Method</a></li><li><a class="tocitem" href="../../geometry/gridgeneration-triang/">Grid Triangulation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Advanced</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../geometry/basics/"><code>GeometricTools.jl</code></a></li><li><a class="tocitem" href="../../geometry/basics-grid/">Cartesian Grid</a></li><li><a class="tocitem" href="../../geometry/basics-transformations/">Space Transformations</a></li><li><a class="tocitem" href="../../geometry/basics-loopedgrid/">Looped Grid</a></li><li><a class="tocitem" href="../../geometry/basics-surfacegrid/">Surface Grid</a></li><li><a class="tocitem" href="../../geometry/panel-gradient/">Panel Gradients</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox" checked/><label class="tocitem" for="menuitem-5"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">Swept Wing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../sweptwing-4p2aoa/">4.2° Angle of Attack</a></li><li><a class="tocitem" href="../sweptwing-aoasweep/">AOA Sweep</a></li><li><a class="tocitem" href="../sweptwing-solver/">Solver Benchmark</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Centerbody</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../centerbody-source/">Source Elements</a></li><li><a class="tocitem" href="../centerbody-slice/">Slice</a></li><li><a class="tocitem" href="../centerbody-vortexring/">Vortex Ring Elements</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Duct</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../duct-aoasweep/">AOA Sweep</a></li><li><a class="tocitem" href="../duct-fluiddomain/">Fluid Domain</a></li><li><a class="tocitem" href="../duct-leastsquares/">Least-Squares Solver</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-4" type="checkbox"/><label class="tocitem" for="menuitem-5-4"><span class="docs-label">Blended Wing Body</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../blendedwingbody-cad/">CAD Model</a></li><li><a class="tocitem" href="../blendedwingbody-gmsh/">Unstructured Meshing</a></li><li><a class="tocitem" href="../blendedwingbody-TE/">Export Trailing Edge</a></li><li><a class="tocitem" href="../blendedwingbody-aero/">Import Mesh and Solve</a></li><li><a class="tocitem" href="../blendedwingbody-gpucpu/">GPU and CPU Acceleration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-5" type="checkbox" checked/><label class="tocitem" for="menuitem-5-5"><span class="docs-label">Cessna 210</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../cessna-openvsp/">OpenVSP Model</a></li><li><a class="tocitem" href="../cessna-TE/">Export Trailing Edge</a></li><li class="is-active"><a class="tocitem" href>Import Mesh and Solve</a></li><li><a class="tocitem" href="../cessna-vspgeom/">VSPGeom.jl</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-6" type="checkbox"/><label class="tocitem" for="menuitem-5-6"><span class="docs-label">Lifting Line</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-5-6-1" type="checkbox"/><label class="tocitem" for="menuitem-5-6-1"><span class="docs-label">Weber Wing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../ll-weber-4p2aoa/">4.2° Angle of Attack</a></li><li><a class="tocitem" href="../ll-weber-aoasweep/">AOA Sweep</a></li></ul></li><li><a class="tocitem" href="../ll-a50k27/">A50K27 Wing</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li><a class="is-disabled">Cessna 210</a></li><li class="is-active"><a href>Import Mesh and Solve</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Import Mesh and Solve</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/byuflowlab/FLOWPanel.jl/blob/master/docs/src/examples/cessna-aero.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><center>
  <img src="https://edoalvar2.groups.et.byu.net/public/FLOWPanel/cessna000.jpg" alt="Pic here" style="width: 100%;"/>
</center><h1 id="Import-Mesh-and-Solve"><a class="docs-heading-anchor" href="#Import-Mesh-and-Solve">Import Mesh and Solve</a><a id="Import-Mesh-and-Solve-1"></a><a class="docs-heading-anchor-permalink" href="#Import-Mesh-and-Solve" title="Permalink"></a></h1><p>Here we import the mesh into FLOWPanel using <a href="https://juliageometry.github.io/MeshesDocs">Meshes.jl</a>, identify the trailing edge, and run the watertight solver.</p><div class="admonition is-info"><header class="admonition-header">Default OpenVSP files</header><div class="admonition-body"><p>We have pre-generated and uploaded an OpenVSP mesh to this example so that you can run this section without needing to complete the previous sections. However, if you would like to use your own mesh, simply change <code>read_path</code>, <code>meshfile</code>, and <code>trailingedges</code> to point to your files.</p></div></div><pre><code class="language-julia hljs">#=##############################################################################
# DESCRIPTION
    Cessna 210 aircraft. The mesh used in this analysis was created using
    OpenVSP.

# AUTHORSHIP
  * Author    : Eduardo J. Alvarez
  * Email     : Edo.AlvarezR@gmail.com
  * Created   : Apri 2024
  * License   : MIT License
=###############################################################################

import FLOWPanel as pnl
import FLOWPanel: norm, dot, cross

import Meshes
import GeoIO
import Rotations: RotX, RotY, RotZ


run_name        = &quot;cessna&quot;                  # Name of this run

save_path       = run_name                  # Where to save outputs
paraview        = true                      # Whether to visualize with Paraview
read_path       = joinpath(pnl.examples_path, &quot;data&quot;) # Where to read Gmsh files from

# ----------------- SIMULATION PARAMETERS --------------------------------------
AOA             = 4.0                       # (deg) freestream angle of attack
magVinf         = 180 * 0.514444            # (m/s) freestream velocity
rho             = 0.71461                   # (kg/m^3) air density at 17300 ft


# ----------------- GEOMETRY DESCRIPTION ---------------------------------------
meshfile        = &quot;cessna.msh&quot;              # Gmsh file to read

offset          = [0, 0, 0]                 # Offset to center the mesh
rotation        = RotX(0*pi/180) * RotY(0*pi/180) * RotX(0*pi/180) # Rotation to align mesh
scaling         = 0.3048                    # Factor to scale mesh dimensions (ft -&gt; m)

trailingedges   = [                         # Gmsh files with trailing edges
#   (  Gmsh file,                    span sorting function,   junction criterion,    closed )
    ( &quot;cessna-TE-leftwing.msh&quot;,      X -&gt; dot(X, [0, 1, 0]),  X -&gt; abs(X[2]) - 0.67, false  ),
    ( &quot;cessna-TE-rightwing.msh&quot;,     X -&gt; dot(X, [0, 1, 0]),  X -&gt; abs(X[2]) - 0.67, false  ),
    ( &quot;cessna-TE-leftelevator.msh&quot;,  X -&gt; dot(X, [0, 1, 0]),  X -&gt; abs(X[2]) - 0.23, false  ),
    ( &quot;cessna-TE-rightelevator.msh&quot;, X -&gt; dot(X, [0, 1, 0]),  X -&gt; abs(X[2]) - 0.23, false  ),
    ( &quot;cessna-TE-rudder.msh&quot;,        X -&gt; dot(X, [0, 0, 1]),  X -&gt; X[3] - 0.65,      false  ),
]

flip            = true                      # Whether to flip control points against the direction of normals
                                            # NOTE: use `flip=true` if the normals
                                            #       point inside the body

bref            = 11.2014                   # (m) reference span
cref            = 1.449324                  # (m) reference chord
Sref            = 16.2344                   # (m^2) reference area
Xac             = [2.815, 0, 0.4142]        # (m) aerodynamic center for
                                            # calculation of moments

# Define function used for reading Gmsh files
meshreader(file) = GeoIO.load(file).geometry

# Format input for `generate_multibody(...)`
meshfiles       = [ (&quot;Airframe&quot;, meshfile, flip) ]

# ----------------- SOLVER SETTINGS -------------------------------------------

# Solver: direct linear solver for open bodies
# bodytype = pnl.RigidWakeBody{pnl.VortexRing} # Wake model and element type

# Solver: least-squares solver for watertight bodies
bodytype        = pnl.RigidWakeBody{pnl.VortexRing, 2}


# ----------------- GENERATE BODY ----------------------------------------------
body, elsprescribe = pnl.generate_multibody(bodytype, meshfiles, trailingedges, meshreader;
                                tolerance=0.001,
                                lengthscale=bref,
                                read_path=read_path,
                                offset=offset, rotation=rotation, scaling=scaling,
                                )


# ----------------- CALL SOLVER ------------------------------------------------
println(&quot;Solving body...&quot;)

# Freestream vector
Vinf = magVinf*[cos(AOA*pi/180), 0, sin(AOA*pi/180)]

# Freestream at every control point
Uinfs = repeat(Vinf, 1, body.ncells)

# Unitary direction of semi-infinite vortex at points `a` and `b` of each
# trailing edge panel
Das = repeat(Vinf/magVinf, 1, body.nsheddings)
Dbs = repeat(Vinf/magVinf, 1, body.nsheddings)

# Solve body (panel strengths) giving `Uinfs` as boundary conditions and
# `Das` and `Dbs` as trailing edge rigid wake direction
@time pnl.solve(body, Uinfs, Das, Dbs; elprescribe=elsprescribe)

# ----------------- POST PROCESSING ----------------------------------------
println(&quot;Post processing...&quot;)

# Calculate surface velocity U on the body
Us = pnl.calcfield_U(body, body)

# NOTE: Since the boundary integral equation of the potential flow has a
#       discontinuity at the boundary, we need to add the gradient of the
#       doublet strength to get an accurate surface velocity

# Calculate surface velocity U_∇μ due to the gradient of the doublet strength
UDeltaGamma = pnl.calcfield_Ugradmu(body)
# UDeltaGamma = pnl.calcfield_Ugradmu(body; sharpTE=true, force_cellTE=false)

# Save this intermediate result in a separate field for debugging
pnl.add_field(body, &quot;Uinfind&quot;, &quot;vector&quot;, collect.(eachcol(Us)), &quot;cell&quot;)

# Add both velocities together
pnl.addfields(body, &quot;Ugradmu&quot;, &quot;U&quot;)

# Calculate pressure coefficient (based on U + U_∇μ)
@time Cps = pnl.calcfield_Cp(body, magVinf)

# Calculate the force of each panel (based on Cp)
@time Fs = pnl.calcfield_F(body, magVinf, rho)

# Calculate total force of the vehicle decomposed as lift, drag, and sideslip
Dhat = Vinf/norm(Vinf)                      # Drag direction
Shat = [0, 1, 0]                            # Span direction
Lhat = cross(Dhat, Shat)                    # Lift direction

LDS = pnl.calcfield_LDS(body, Lhat, Dhat)
L, D, S = collect(eachcol(LDS))

# Force coefficients
nondim = 0.5*rho*magVinf^2*Sref             # Normalization factor
CL = sign(dot(L, Lhat)) * norm(L) / nondim
CD = sign(dot(D, Dhat)) * norm(D) / nondim

# Integrated moment decomposed into rolling, pitching, and yawing moments
lhat = Dhat                                 # Rolling direction
mhat = Shat                                 # Pitching direction
nhat = Lhat                                 # Yawing direction

lmn = pnl.calcfield_lmn(body, Xac, lhat, mhat, nhat)
roll, pitch, yaw = collect(eachcol(lmn))

# Moment coefficients
nondim = 0.5*rho*magVinf^2*Sref*cref # Normalization factor

Cl = sign(dot(roll, lhat)) * norm(roll) / nondim
Cm = sign(dot(pitch, mhat)) * norm(pitch) / nondim
Cn = sign(dot(yaw, nhat)) * norm(yaw) / nondim

@show L
@show D
@show CL
@show CD
@show Cl
@show Cm
@show Cn

# ----------------- VISUALIZATION ------------------------------------------

# Save body as VTK
vtks = save_path*&quot;/&quot;                        # String with VTK output files
vtks *= pnl.save(body, run_name; path=save_path, debug=false)

# NOTE: using `debug=true` outputs the control points and normal, but it takes
#       much longer since it also calculates the velocity at those points

# Call Paraview
if paraview
    run(`paraview --data=$(vtks)`)
end</code></pre><span style="font-size: 0.9em; color:gray;"><i>
    Number of panels: 24,000. <br>
    Run time: ~100 seconds on a Dell Precision 7760 laptop (no GPU). <br>
</i></span>
<br><br><table><tr><th style="text-align: right"></th><th style="text-align: center">VSPAERO</th><th style="text-align: center">FLOWPanel</th></tr><tr><td style="text-align: right">Lift <span>$C_L$</span></td><td style="text-align: center">0.499</td><td style="text-align: center">0.554</td></tr><tr><td style="text-align: right">Drag <span>$C_D$</span></td><td style="text-align: center">0.0397</td><td style="text-align: center">0.0496</td></tr></table><center>
  <img src="https://edoalvar2.groups.et.byu.net/public/FLOWPanel/cessna002.jpg" alt="Pic here" style="width: 100%;"/>
  <img src="https://edoalvar2.groups.et.byu.net/public/FLOWPanel/cessna005.jpg" alt="Pic here" style="width: 100%;"/>
</center>
<br><br>
<br><br><div class="admonition is-category-details"><header class="admonition-header">Tip</header><div class="admonition-body"><p>You can also automatically run this example with the following command:</p><pre><code class="language-julia hljs">import FLOWPanel as pnl

include(joinpath(pnl.examples_path, &quot;cessna.jl&quot;))</code></pre></div></div><div class="admonition is-category-details"><header class="admonition-header">Checklist for importing meshes</header><div class="admonition-body"><ol><li><strong>Check whether normals point into the body:</strong> Using the flag  <code>debug=true</code> in <code>pnl.save(body, run_name; path=save_path, debug=true)</code>  will output the control points of the body along with the associated  normal vector of each panel.      We recommend opening the body and control points in ParaView and  visualizing the normals with the Glyph filter.      Whenever the normals are pointing into the body, the user needs  to flip the offset of the  control points with <code>CPoffset=-1e-14</code> or any other negligibly small  negative number. This won&#39;t flip the normals outwards, but it will flip  the zero-potential domain from outwards back to inside the body  (achieved by shifting the control points slightly into the body).  If you pull up the solution in ParaView and realize that the surface  velocity is much smaller than the freestream everywhere along the  aircraft, that&#39;s an indication that the normals are point inwards  and you need to set <code>CPoffset</code> to be negative.</li><li><strong>Check that the trailing edge was correctly identified:</strong>  <code>pnl.save(body, run_name; path=save_path)</code> automatically outputes the  wake.      We recommend opening the body and wake in ParaView and visually  inspecting that the wake runs along the trailing edge line that you  defined under <code>trailingedge</code>.      If not successful, increase the resolution of <code>trailingedge</code> and tighten  the tolerance to something small like  <code>pnl.calc_shedding(grid, trailingedge; tolerance=0.0001*span)</code>.</li><li><strong>Choose the right solver for the geometry:</strong>  Use the least-squares solver with watertight bodies  (<code>bodytype = pnl.RigidWakeBody{pnl.VortexRing, 2}</code>), and the direct  linear solver with open bodies  (<code>bodytype = pnl.RigidWakeBody{pnl.VortexRing}</code>). The least-squares  solver runs much faster in GPU  (<code>pnl.solve(body, Uinfs, Das, Dbs; GPUArray=CUDA.CuArray{Float32})</code>),  but it comes at the price of sacrificing accuracy (single precision  numbers as opposed to double).</li></ol></div></div><div class="admonition is-success"><header class="admonition-header">Visualization</header><div class="admonition-body"><p>To help you practice in ParaView, we have uploaded the solution files of this simulation along with the ParaView state file (<code>.pvsm</code>) that we used to generate the visualizations shown above: <a href="https://edoalvar2.groups.et.byu.net/public/FLOWPanel/cessna.zip">DOWNLOAD</a></p><p>To open in ParaView: <code>File → Load State → cessna.pvsm</code> then select &quot;Search files under specified directory&quot; and point it to the folder with the outputs of FLOWPanel.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../cessna-TE/">« Export Trailing Edge</a><a class="docs-footer-nextpage" href="../cessna-vspgeom/">VSPGeom.jl »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 9 January 2026 23:34">Friday 9 January 2026</span>. Using Julia version 1.11.8.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
